# PROJECT KNOWLEDGE BASE

**Generated:** 2026-02-16T02:31:23Z
**Commit:** c19b1a1
**Branch:** develop

## OVERVIEW
Discord bot + archive worker + CLI in one TypeScript package. Core domains are Discord event handling, icon replacement/search, LLM summarization/QA, embedding pipelines, and optional Kafka fan-out.

## STRUCTURE
```text
./
|- src/                    # runtime code (see src/AGENTS.md)
|  |- index.ts             # main bot runtime
|  |- archive.ts           # archive runtime
|  |- cli.ts               # ops CLI entrypoint
|  |- deploy-commands.ts   # slash command registration tool
|  |- controller/          # Discord event entrypoints
|  |- service/             # application workflows
|  |- repository/          # data/provider adapters
|  |- database/            # mongoose connection + schemas
|  \- utils/               # cross-cutting helpers + prompts
|- docs/readme.md          # local bootstrap order
|- scripts/                # docker helper scripts
\- .github/workflows/      # develop->main PR automation
```

## WHERE TO LOOK
| Task | Location | Notes |
|------|----------|-------|
| Bot startup/login | `src/index.ts` | Connects Mongo + registers events + logs in client |
| Archive startup | `src/archive.ts` | Separate runtime, includes process signal + Kafka cleanup |
| Event routing | `src/controller/index.ts` | Message, interaction, modal wiring |
| Slash command loading | `src/service/commands/index.ts` | Dynamic file discovery + runtime import contract |
| Command deploy flow | `src/deploy-commands.ts` | Purge + register global slash commands |
| LLM summarize/question | `src/service/messageService.ts`, `src/utils/llm/` | Prompt-driven Korean responses |
| Embedding/search | `src/service/embedding/`, `src/service/searchService.ts` | OCR/summarization + vector/search logic |
| Persistence models | `src/database/model/*.ts` | Mongo schemas + indexes |
| Cross-cutting Discord payload helpers | `src/utils/discord/index.ts` | `LogContext`, embed/payload constructors |
| Runtime commands | `package.json` | `dev`, `archive-dev`, `cli`, `cmd-dev`, `build`, `start` |

## CODE MAP
LSP symbol APIs were unavailable during generation in this environment. Use scoped AGENTS files under `src/` for module-level maps.

## CONVENTIONS
- Runtime env naming is `prod`/`dev` (not `production`/`development`); config picks `.env` for prod, `.env.dev` otherwise.
- Toolchain is pinned to Node 20.x + Yarn classic (`yarn@1.22.22`).
- TypeScript build is CommonJS, strict mode, emits declarations and strips comments.
- `cmd-prod` still runs TS source via `tsx` (`src/deploy-commands.ts`) instead of `dist/*`.
- CI workflow only automates PR creation from `develop` to `main`; there is no build/test quality gate in Actions.

## ANTI-PATTERNS (THIS PROJECT)
- Do not edit `yarn.lock` manually (`DO NOT EDIT THIS FILE DIRECTLY`).
- Do not copy raw conversation text into QA/summarization outputs (`src/utils/llm/prompt-question.txt`).
- Do not include usernames/person-identifying names in generated summaries (`src/utils/llm/prompt-question.txt`, `src/utils/llm/prompt-summarization.txt`).
- Do not add intro/outro boilerplate like "This image/content is ..." in embedding preprocess outputs (`src/service/embedding/client.ts`).
- Do not drop sensitive/uncomfortable source wording during summarization prompts; preserve source wording semantics (`src/utils/llm/prompt-question.txt`).

## UNIQUE STYLES
- Multi-runtime single package: main bot, archive worker, CLI, and command deploy tool coexist.
- Slash commands are plugin-like files loaded dynamically from `src/service/commands/`.
- Korean-first UX text for command descriptions and AI-facing output policy.
- Optional Kafka publishing is feature-gated by config (`KAFKA_ENABLE`, `KAFKA_REST_PROXY`).

## COMMANDS
```bash
# local bootstrap (from docs/readme.md)
yarn cmd-dev
yarn dev

# main runtime
yarn dev
yarn build
yarn start

# archive runtime
yarn archive-dev
yarn archive-start

# operations
yarn cli --help
yarn cmd-dev
yarn cmd-prod
yarn lint
yarn lint:format

# docker helpers (destructive recreate)
./scripts/docker-up.sh
./scripts/docker-register-commands.sh
```

## NOTES
- No project test command is defined; no test framework config was found.
- `tsconfig.build.json` excludes `test` and `**/*spec.ts` from build output.
- `scripts/docker-up.sh` removes compose containers and volumes before recreate.
- For subsystem details, start at `src/AGENTS.md` and drill down to child AGENTS files.
